<!DOCTYPE html>
<html>

<head>
<script type="text/javascript" src="jquery-3.2.1.js"></script>
<script type="text/javascript">
	// This function is called on page load.

	function drawOnCanvas() {
		drawCanvas1()
		drawCanvas2()
		$("canvas").click(function(event){
			clickOnCanvas(event)
		})
	}


	function drawCanvas1() {

		// Get the canvas element.
		var canvas = document.getElementById("canvas1");

		addCanvas(canvas)

		// Make sure you got it.
		if (canvas.getContext)

		// If you have it, create a canvas user interface element.
		{
			// Specify 2d canvas type.
			var ctx = canvas.getContext("2d");

			// Draw gold UI element.
			// Start the path.
			ctx.beginPath();

			// Define the fill color in RGB for gold.
			ctx.fillStyle = "rgb(255 ,215 ,0)";

			// Draw the circle using an arc.
			ctx.arc(100, 100, 50, 0, 2 * Math.PI, true);

			// Fill the circle.
			ctx.fill();
		}
	}

	function drawCanvas2() {

		// Get the canvas element.
		var canvas = document.getElementById("canvas2");
		addCanvas(canvas)

		// Make sure you got it.
		if (canvas.getContext)

		// If you have it, create a canvas user interface element.
		{
			// Specify 2d canvas type.
			var ctx = canvas.getContext("2d");

			// Draw gold UI element.
			// Start the path.
			ctx.beginPath();

			// Define the fill color in RGB for gold.
			ctx.fillStyle = "rgb(255 ,000 ,255)";

			// Draw the circle using an arc.
			ctx.arc(200, 100, 50, 0, 2 * Math.PI, true);

			// Fill the circle.
			ctx.fill();
		}
	}
	
//  Walk through canvases until non-transparent item found

	function walkcanvasses(f) {
		var done = false
		var zKeys = Object.keys(canvasses).sort().reverse()
		for(zIx in zKeys){
			var zKey = zKeys[zIx] 
			var zMap = canvasses[zKey]
			var oKeys = Object.keys(zMap).sort().reverse()
			for(oIx in oKeys){
				var oKey = oKeys[oIx]
				var canvas = zMap[oKey]
				if(f(canvas)){
					return
				}
			}
		}
	}

    // This function is called when you click the canvas.

	function clickOnCanvas(event) {

		event = event || window.event
		var x = event.clientX
		var y = event.clientY

		walkcanvasses(function(src){
			var dx = x - src.offsetLeft
			var dy = y - src.offsetTop
	
			var ctx = src.getContext("2d")
	
			var c = ctx.getImageData(dx, dy, 1, 1).data;
	
			if (transparent(c)) {
				return false
			} else {
				alert("click "+ src.id);
				return true
			}
		})
	}

	function transparent(color) {
		var t = (color[0] + color[1] + color[2]) * color[3]
		return t == 0
	}
</script>
</head>

<body onload="drawOnCanvas()">
	<h1>Canvas User Interface</h1>
	<!-- Create the Canvas element. -->
	<canvas id="canvas1" width="400" height="200" 
		style="z-index: 1; border-width: 8px; position: absolute; top: 100; left: 10;">Browser does not support HTML5 Canvas</canvas>
	<canvas id="canvas2" width="400" height="200" 
		style="z-index: 2; border-width: 8px; position: absolute; top: 100; left: 10;">Browser does not support HTML5 Canvas</canvas>
	<p>Click on the gold circular user interface element.</p>
</body>

</html>
